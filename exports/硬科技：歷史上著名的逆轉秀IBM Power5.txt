硬科技：歷史上著名的逆轉秀IBM Power5
https://www.cool3c.com/article/160480
2021-04-06
Power5 硬科技 AMD 專家觀點 ibm

2004年第二季，除了NVIDIA在NV40表演了一場華麗的逆轉秀，那年的夏天，在高階伺服器CPU市場更上演了一場空前絕後的「效能大屠殺」：藍色巨人IBM在7月14日發表了採用Power5(代號”Squadron”)處理器的伺服器，包括雙處理器的p5-520、四處理器的p5-550和16處理器的p5-570(當然後來又追加一堆機種，像「開放」的OpenPower 720)。

硬科技：「簡報王」和他們的產地IBM Power Everywhere篇

IBM早在2003年的HotChips 15初步公開Power5的技術概要，2003年底的Microprocessor Forum發布規格細節，大家也都很清楚Power5是以Power4為基礎的延伸加強版。但世人萬萬沒想到的是：結合同時多執行緒(SMT)和大翻修後的記憶體子系統，Power5的效能表現竟然會「剌麼厲害」，把所有擂台上的競爭對手通通轟到了觀眾席。

硬科技：AMD同時多執行緒SMT4是什麼？圖解CPU各種核心與執行緒關係

博學的科科一定會很好奇：1999年底披露、2001年上市的Power4(代號”Regatta”)，是計算機工業史上首顆原生雙核心泛用CPU，不僅相容了IBM所有的商用RISC指令集(RS/6000、AS/400、PowerPC)，也有大量個人電腦無緣一親芳澤的尖端技術，那為何Power5會如此令人感到震撼？

答案很簡單：因為Power4的效能表現實在有點讓人感到差強人意，並沒有替當時的IBM帶來明顯的優勢，而Power5橫空出世的好戲，也清楚告訴大家Power4的弱點究竟在哪裡，也充分彰顯了後來x86處理器的幾個重要的技術趨勢。

首先，Power5導入同時多執行緒(SMT)，每個處理器核心等同於2個邏輯處理器。科科們也許會馬上反應：Intel的HyperThreading也不就這樣嗎？但IBM畢竟是那個領導計算機工業數十年的伺服器王者，做出來的東西也絕非「區區個人電腦背景」的Intel AMD所能比擬，除了在AIX作業系統可「動態」啟動關閉SMT模式，當無須第二條執行緒時，就將資源集中給單一執行緒(你的眼睛絕對沒看錯)，更可藉由分配「8個」指令解碼器給2條執行緒，調控執行緒的效能優先權(你的眼睛還是沒看錯)。

相較於Intel在Pentium 4實做HyperThreading僅增加5%功能電路，為了充分提高效能，Power5比Power4整整多出了24%，如更充沛的實體暫存器檔案等等。

其次，記憶體子系統更是Power5的重頭戲，L3快取記憶體控制器直通處理器核心，變相成為L2的延伸，並整合了記憶體控制器，也提昇了不同Power5晶片之間的匯流排(和多處理器延展性息息相關的快取資料一致性協定、和大型多處理器架構層面的改善項目，就不須在這裡解釋了)。2003年底Microprocessor Report那句 “Power5 Tops On Bandwidth” 標題，堪稱最好的註腳。

硬科技：AMD移除用了17年的整合式記憶體控制器 AMD為何這麼做？

大幅縮減的L3快取與記憶體延遲，有如激增效能的威而剛。

L3快取記憶體也透過多晶片封裝跟處理器包在一起，整合度更高，也精簡系統架構的複雜度。

從1964年的S/360為起點的IBM大型主機，其虛擬化領域的獨門絕活，也陸續「下放」到Power體系，Power5具備微分割區(Micro-Partitioning)，最多配置10個分割區，以1%為基本單位，可精細的設定每個分割區的資源比例與使用權限(別再懷疑了，你的眼睛沒有問題)，可將所有運算能量都砸在刀口上，毫無一絲一毫浪費。這些看似外星科技的特性，也一直存在於IBM的高階伺服器並持續進化中。

什麼是「大型主機」？

好啦，前面扯了這麼多，那Power5到底是厲害到什麼程度？

在TPC-C公佈的測試數據，16顆雙核心Power5的p5-570，足以抗衡「64顆」Intel Itanium 2的HP Integrity SuperDome。SAP SD-2 Tier測試，8顆Power5勝過「32顆」Itanium 2和「36顆」Sun UltraSPARC IV。至於SPEC CPU，Power5一舉創下浮點項目的歷史新高，單核心效能更是Intel Itanium 2的「2倍」。更扯的還在後面，2004年11月的p5-595(32顆Power5)，創下TPC-C世界紀錄，效能相當於「二、三、四名的總和」，和同級產品相比，不是人家的2倍3倍，就是4倍5倍，甚至快要6倍。

簡而言之，就是「1個核心打對方2個還有剩」的概念。同樣擁有SMT和整合記憶體控制器，IBM和Intel/AMD相比，同樣是肝藥處方，相同提煉，做法不同，成本效果也不同，斯斯保肝... 呃，總之就是天差地遠。

最後，那Power4的弱點是哪些？說穿了不外乎「佈署龐大執行單元但使用效益不佳」和「記憶體子系統不夠有力」，IBM就對症下藥，在2004年的夏天，再次確立其伺服器王者的地位。順便講一下，Power4的總工程師叫做Chuck Moore，後來跳槽到AMD主動並操刀推土機的研發... 然後？就沒有然後了。

硬科技：回顧AMD Zen微架構和EPYC (上)
硬科技：回顧AMD Zen微架構和EPYC (中)
硬科技：回顧AMD Zen微架構和EPYC (下)
IBM Power 9處理器解析 地球上最強大泛用處理器

不過，想必科科們一定會好奇，像Power5這種各方面都強到誇張的高階伺服器CPU，1顆大概要多少錢？筆者只能說，當年IBM的替料維修報價，Power5都是「10000美元為基本單位」起跳，保證讓你看到連科科笑都笑不出來，也難怪IBM Power10敢用外界質疑良率不佳的Samsung 7nm製程了。科科。

